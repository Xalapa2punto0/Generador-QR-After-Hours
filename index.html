<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QR con logo y ojos redondeados</title>
<style>
  body{font-family:sans-serif;background:#f5f5f5;padding:20px}
  .card{background:#fff;padding:20px;max-width:500px;margin:auto;
        border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
  #qr{display:flex;justify-content:center;margin:20px 0}
  input,button{padding:10px;font-size:16px;margin:6px 0;width:100%}
  button{background:#0b69ff;color:#fff;border:none;border-radius:8px;
         cursor:pointer;font-weight:600}
</style>
</head>
<body>
<div class="card">
  <h1>Generador de QR con logo y ojos redondeados</h1>
  <input id="text" type="text" placeholder="Texto o URL">
  <button id="gen">Generar QR</button>
  <div id="qr"></div>
  <button id="shareBtn" style="display:none;">Compartir QR</button>
</div>

<!-- qrcode-styling desde CDN (ruta estable de jsdelivr) -->
<script src="https://cdn.jsdelivr.net/npm/qrcode-styling@1.6.0/dist/qrcode-styling.js"></script>
<script>
const genBtn = document.getElementById('gen');
const qrContainer = document.getElementById('qr');
const shareBtn = document.getElementById('shareBtn');

let qrCode; // guardaremos la instancia

genBtn.addEventListener('click', () => {
  const text = document.getElementById('text').value.trim();
  if(!text){ alert('Escribe un texto'); return; }

  // Si ya existe un QR previo, eliminarlo
  qrContainer.innerHTML = '';

  qrCode = new QRCodeStyling({
    width: 300,
    height: 300,
    type: 'canvas',
    data: text,
    image: 'logo.png',
    imageOptions: {
      crossOrigin: 'anonymous',
      margin: 8      // margen negro alrededor del logo
    },
    dotsOptions: {
      color: '#000000',
      type: 'rounded' // puntos redondeados
    },
    cornersSquareOptions: {
      type: 'extra-rounded', // Ojos (detectores) redondeados
      color: '#000000'
    },
    cornersDotOptions: {
      type: 'dot',
      color: '#000000'
    },
    backgroundOptions: {
      color: '#ffffff'
    }
  });

  qrCode.append(qrContainer);
  shareBtn.style.display = 'block';
});

shareBtn.addEventListener('click', async ()=>{
  if (!qrCode) return;

  // Exportar a blob para compartir
  const blob = await qrCode.getRawData('png');

  if (navigator.share && navigator.canShare?.({ files: [new File([blob], 'qr.png', {type:'image/png'})] })) {
    const file = new File([blob], 'qr.png', { type: 'image/png' });
    navigator.share({
      files: [file],
      title: 'Código QR',
      text: 'Aquí está el código QR que generé'
    });
  } else {
    // Fallback: enlace de WhatsApp sólo con texto
    const text = 'Mira este código QR: (adjunta la imagen manualmente)';
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank');
  }
});
</script>
</body>
</html>
