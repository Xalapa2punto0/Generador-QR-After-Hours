<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QR con logo y borde redondeado</title>
<style>
  body{
    font-family:sans-serif;
    background:#f5f5f5;
    padding:20px;
  }
  .card{
    background:#fff;
    padding:20px;
    max-width:500px;
    margin:auto;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.1);
  }
  #qr{
    display:flex;
    justify-content:center;
    margin:20px 0;
  }
  input,button{
    padding:10px;
    font-size:16px;
    margin:6px 0;
    width:100%;
  }
  button{
    background:#0b69ff;
    color:#fff;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
</style>
</head>
<body>
<div class="card">
  <h1>Generador de QR con logo y borde redondeado</h1>
  <input id="text" type="text" placeholder="Texto o URL">
  <button id="gen">Generar QR</button>
  <div id="qr"></div>
  <button id="shareBtn" style="display:none;">Compartir QR</button>
</div>

<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script>
const genBtn = document.getElementById('gen');
const qrContainer = document.getElementById('qr');
const shareBtn = document.getElementById('shareBtn');
let qrCode;

async function logoConBorde(src, borde = 8){
  return new Promise((resolve)=>{
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = function(){
      const s = Math.max(img.width, img.height) + borde*2;
      const c = document.createElement('canvas');
      c.width = c.height = s;
      const ctx = c.getContext('2d');

      // Fondo transparente
      ctx.clearRect(0,0,s,s);

      // Dibuja borde negro redondeado
      const radio = s/2;
      ctx.beginPath();
      ctx.fillStyle = '#000';
      ctx.arc(radio, radio, radio, 0, Math.PI*2);
      ctx.fill();

      // Dibuja el logo centrado
      ctx.save();
      ctx.beginPath();
      ctx.arc(radio, radio, radio - borde, 0, Math.PI*2);
      ctx.clip();
      ctx.drawImage(img, (s - img.width)/2, (s - img.height)/2);
      ctx.restore();

      resolve(c.toDataURL('image/png'));
    };
    img.src = src;
  });
}

genBtn.addEventListener('click', async () => {
  const text = document.getElementById('text').value.trim();
  if(!text){ alert('Escribe un texto'); return; }

  qrContainer.innerHTML = '';

  // Genera un logo con borde negro redondeado
  const logoBordeado = await logoConBorde('logo.png', 8);

  qrCode = new QRCodeStyling({
    width: 300,
    height: 300,
    type: 'canvas',
    data: text,
    image: logoBordeado,        // usamos el logo con su borde
    imageOptions: { margin:0 }, // ya no necesitamos margin
    dotsOptions: { color:'#000', type:'rounded' },
    cornersSquareOptions: { type:'extra-rounded', color:'#000' },
    cornersDotOptions: { type:'dot', color:'#000' },
    backgroundOptions: { color:'#fff' }
  });

  qrCode.append(qrContainer);
  shareBtn.style.display = 'block';
});

shareBtn.addEventListener('click', async ()=>{
  if (!qrCode) return;
  const blob = await qrCode.getRawData('png');
  if (navigator.share &&
      navigator.canShare?.({ files: [new File([blob], 'qr.png', {type:'image/png'})] })) {
    const file = new File([blob], 'qr.png', { type: 'image/png' });
    navigator.share({
      files: [file],
      title: 'Código QR',
      text: 'Aquí está el código QR que generé'
    });
  } else {
    const text = 'Mira este código QR: (adjunta la imagen manualmente)';
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank');
  }
});
</script>
</body>
</html>
